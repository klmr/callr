<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Evaluate an expression in another R session, in the background — r_bg • callr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate an expression in another R session, in the background — r_bg"><meta property="og:description" content="Starts evaluating an R function call in a background R process, and
returns immediately."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">callr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">3.7.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://www.tidyverse.org/blog/2019/09/callr-task-q" class="external-link">A multi process task queue in 100 lines of R code</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/r-lib/callr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Evaluate an expression in another R session, in the background</h1>
    <small class="dont-index">Source: <a href="https://github.com/r-lib/callr/blob/HEAD/R/eval-bg.R" class="external-link"><code>R/eval-bg.R</code></a></small>
    <div class="hidden name"><code>r_bg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Starts evaluating an R function call in a background R process, and
returns immediately.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">r_bg</span><span class="op">(</span>
  <span class="va">func</span>,
  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,
  libpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/libPaths.html" class="external-link">.libPaths</a></span><span class="op">(</span><span class="op">)</span>,
  repos <span class="op">=</span> <span class="fu"><a href="default_repos.html">default_repos</a></span><span class="op">(</span><span class="op">)</span>,
  stdout <span class="op">=</span> <span class="st">"|"</span>,
  stderr <span class="op">=</span> <span class="st">"|"</span>,
  poll_connection <span class="op">=</span> <span class="cn">TRUE</span>,
  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"callr.error"</span>, <span class="st">"error"</span><span class="op">)</span>,
  cmdargs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--slave"</span>, <span class="st">"--no-save"</span>, <span class="st">"--no-restore"</span><span class="op">)</span>,
  system_profile <span class="op">=</span> <span class="cn">FALSE</span>,
  user_profile <span class="op">=</span> <span class="st">"project"</span>,
  env <span class="op">=</span> <span class="fu"><a href="rcmd_safe_env.html">rcmd_safe_env</a></span><span class="op">(</span><span class="op">)</span>,
  supervise <span class="op">=</span> <span class="cn">FALSE</span>,
  package <span class="op">=</span> <span class="cn">FALSE</span>,
  arch <span class="op">=</span> <span class="st">"same"</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>func</dt>
<dd><p>Function object to call in the new R process.
The function should be self-contained and only refer to
other functions and use variables explicitly from other packages
using the <code>::</code> notation. By default the environment of the function
is set to <code>.GlobalEnv</code> before passing it to the child process.
(See the <code>package</code> option if you want to keep the environment.)
Because of this, it is good practice to create an anonymous
function and pass that to <code>callr</code>, instead of passing
a function object from a (base or other) package. In particular</p><div class="sourceCode"><pre><code><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="va">.libPaths</span><span class="op">)</span></code></pre></div>

<p>does not work, because <code>.libPaths</code> is defined in a special
environment, but</p><div class="sourceCode"><pre><code><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/libPaths.html" class="external-link">.libPaths</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>

<p>works just fine.</p></dd>
<dt>args</dt>
<dd><p>Arguments to pass to the function. Must be a list.</p></dd>
<dt>libpath</dt>
<dd><p>The library path.</p></dd>
<dt>repos</dt>
<dd><p>The <code>repos</code> option. If <code>NULL</code>, then no
<code>repos</code> option is set. This options is only used if
<code>user_profile</code> or <code>system_profile</code> is set <code>FALSE</code>,
as it is set using the system or the user profile.</p></dd>
<dt>stdout</dt>
<dd><p>The name of the file the standard output of
the child R process will be written to.
If the child process runs with the <code>--slave</code> option (the default),
then the commands are not echoed and will not be shown
in the standard output. Also note that you need to call <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
explicitly to show the output of the command(s).</p></dd>
<dt>stderr</dt>
<dd><p>The name of the file the standard error of
the child R process will be written to.
In particular <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> sends output to the standard
error. If nothing was sent to the standard error, then this file
will be empty. This argument can be the same file as <code>stdout</code>,
in which case they will be correctly interleaved. If this is the
string <code>"2&gt;&amp;1"</code>, then standard error is redirected to standard output.</p></dd>
<dt>poll_connection</dt>
<dd><p>Whether to have a control connection to
the process. This is used to transmit messages from the subprocess
to the main process.</p></dd>
<dt>error</dt>
<dd><p>What to do if the remote process throws an error.
See details below.</p></dd>
<dt>cmdargs</dt>
<dd><p>Command line arguments to pass to the R process.
Note that <code>c("-f", rscript)</code> is appended to this, <code>rscript</code>
is the name of the script file to run. This contains a call to the
supplied function and some error handling code.</p></dd>
<dt>system_profile</dt>
<dd><p>Whether to use the system profile file.</p></dd>
<dt>user_profile</dt>
<dd><p>Whether to use the user's profile file.
If this is <code>"project"</code>, then only the profile from the working
directory is used, but the <code>R_PROFILE_USER</code> environment variable
and the user level profile are not. See also "Security considerations"
below.</p></dd>
<dt>env</dt>
<dd><p>Environment variables to set for the child process.</p></dd>
<dt>supervise</dt>
<dd><p>Whether to register the process with a supervisor. If <code>TRUE</code>,
the supervisor will ensure that the process is killed when the R process
exits.</p></dd>
<dt>package</dt>
<dd><p>Whether to keep the environment of <code>func</code> when passing
it to the other package. Possible values are:</p><ul><li><p><code>FALSE</code>: reset the environment to <code>.GlobalEnv</code>. This is the default.</p></li>
<li><p><code>TRUE</code>: keep the environment as is.</p></li>
<li><p><code>pkg</code>: set the environment to the <code>pkg</code> package namespace.</p></li>
</ul></dd>
<dt>arch</dt>
<dd><p>Architecture to use in the child process, for multi-arch
builds of R. By default the same as the main process. See
<code><a href="supported_archs.html">supported_archs()</a></code>. If it contains a forward or backward slash
character, then it is taken as the path to the R executable.
Note that on Windows you need the path to <code>Rterm.exe</code>.</p></dd>
<dt>...</dt>
<dd><p>Extra arguments are passed to the <a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a>
constructor.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An <code>r_process</code> object, which inherits from <a href="http://processx.r-lib.org/reference/process.html" class="external-link">process</a>,
so all <code>process</code> methods can be called on it, and in addition it also
has a <code><a href="get_result.html">get_result()</a></code> method to collect the result.</p>
    </div>
    <div id="security-considerations">
    <h2>Security considerations</h2>
    


<p><code>callr</code> makes a copy of the user's <code>.Renviron</code> file and potentially of
the local or user <code>.Rprofile</code>, in the session temporary
directory. Avoid storing sensitive information such as passwords, in
your environment file or your profile, otherwise this information will
get scattered in various files, at least temporarily, until the
subprocess finishes. You can use the keyring package to avoid passwords
in plain files.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">rx</span> <span class="op">&lt;-</span> <span class="fu">r_bg</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># wait until it is done</span></span>
<span class="r-in"><span class="va">rx</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rx</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rx</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, RStudio, Mango Solutions.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

